#include "display.h"

void lcd_write_string(uint8_t *buffer, char * str) {

	if(strlen(str) < 125) {

		int i, j = 0;

		while (*str != '\0') {

			for (i = 0; i <5; i++) {

				buffer[i + (j * 5)] = character_data[*str-32][i];
			}
			str++;
			j++;
		}
	} else printf("For stor en lÃ¦ngde\n");
}

void lcd_str_line(uint8_t *buffer, char* str, uint8_t line){
	uint8_t i,j;
	if(line>=0 && line < 4){
		for(i=0;i<26;i++){
			if(str[i]=='\0') break;

			for(j=0; j<5; j++){
				if(i==25 && j>2) break;
				buffer[i*5+j+line*128] = character_data[str[i]-32][j];
			}
		}
	}
}

void lcd_str_offset(uint8_t *buffer, char* str, uint8_t line,uint8_t offset){
	uint8_t i,j;
	if(line>=0 && line < 4){
		for(i=0;i<26-offset;i++){
			if(str[i]=='\0') break;

			for(j=0; j<5; j++){
					if(i==25-offset && j>2) break;
				buffer[i*5+j+line*128+offset*5] = character_data[str[i]-32][j];
			}
		}
	}
}

void lcd_extra_offset(uint8_t *buffer, char* str, uint8_t line,uint8_t offset){
	uint8_t i,j;
	if(line>=0 && line < 4){
		for(i=0;i<26-offset;i++){
			if(str[i]=='\0') break;

			for(j=0; j<5; j++){
					if(i==25-offset && j>2) break;
				buffer[i*5+j+line*128+offset*5] = extra_display_data[str[i]-32][j];
			}
		}
	}
}

void lcd_set_pixels(uint1_t pixelarr[][32], uint8_t* buffer){
	uint8_t x, y;
	for(x=0;x<128;x++){
		for(y=0;y<4;y++){
			buffer[x+y*128] = (pixelarr[x][y*8+7] << 7)
						|(pixelarr[x][y*8+6] << 6)
						|(pixelarr[x][y*8+5] << 5)
						|(pixelarr[x][y*8+4] << 4)
						|(pixelarr[x][y*8+3] << 3)
						|(pixelarr[x][y*8+2] << 2)
						|(pixelarr[x][y*8+1] << 1)
						|(pixelarr[x][y*8]);
		}
	}
}

void lcd_update(uint8_t* buffer,char style){
	uint16_t i, tmpl0,tmpl1,tmpl2,tmpl3;
	switch(style){
		case 'R':
			tmpl0 = buffer[127];
			tmpl1 = buffer[255];
			tmpl2 = buffer[383];
			tmpl3 = buffer[511];
			for(i=127; i>0;i--){
				buffer[i] = buffer[i-1];
				buffer[i+128] = buffer[i+127];
				buffer[i+256] = buffer[i+255];
				buffer[i+384] = buffer[i+383];
			}
			buffer[0]= tmpl0;
			buffer[128]= tmpl1;
			buffer[256]= tmpl2;
			buffer[384]= tmpl3;
			break;
		case 'L':
			tmpl0 =buffer[0];
			tmpl1 = buffer[128];
			tmpl2 =  buffer[256];
			tmpl3 =  buffer[384];
			for(i=0; i<127;i++){
				buffer[i] = buffer[i+1];
				buffer[i+128] = buffer[i+129];
				buffer[i+256] = buffer[i+257];
				buffer[i+384] = buffer[i+385];
			}
			buffer[127]= tmpl0;
			buffer[255]= tmpl1;
			buffer[383]= tmpl2;
			buffer[511]= tmpl3;
			break;
		case 'r':
			tmpl0 = buffer[511];
			for(i=511; i>0;--i){
				buffer[i] = buffer[i-1];
			}
			buffer[0]= tmpl0;
			break;
		case 'l':
			tmpl0 =  buffer[0];
			for(i=0; i<511;i++){
				buffer[i] = buffer[i+1];
			}
			buffer[511]= tmpl0;
			break;
		default:
			break;
	}
}

const char character_data[95][5] = {
  {0x00, 0x00, 0x00, 0x00, 0x00},
  {0x00, 0x5F, 0x5F, 0x00, 0x00},
  {0x00, 0x07, 0x00, 0x07, 0x00},
  {0x14, 0x7F, 0x14, 0x7F, 0x14},
  {0x24, 0x2A, 0x7F, 0x2A, 0x12},
  {0x23, 0x13, 0x08, 0x64, 0x62},
  {0x36, 0x49, 0x55, 0x22, 0x50},
  {0x00, 0x05, 0x03, 0x00, 0x00},
  {0x00, 0x1C, 0x22, 0x41, 0x00},
  {0x00, 0x41, 0x22, 0x1C, 0x00},
  {0x14, 0x08, 0x3E, 0x08, 0x14},
  {0x08, 0x08, 0x3E, 0x08, 0x08},
  {0x00, 0x50, 0x30, 0x00, 0x00},
  {0x08, 0x08, 0x08, 0x08, 0x08},
  {0x00, 0x60, 0x60, 0x00, 0x00},
  {0x20, 0x10, 0x08, 0x04, 0x02},
  {0x3E, 0x51, 0x49, 0x45, 0x3E},
  {0x00, 0x42, 0x7F, 0x40, 0x00},
  {0x42, 0x61, 0x51, 0x49, 0x46},
  {0x22, 0x49, 0x49, 0x49, 0x36},
  {0x18, 0x14, 0x12, 0x7F, 0x10},
  {0x2F, 0x49, 0x49, 0x49, 0x31},
  {0x3E, 0x49, 0x49, 0x49, 0x32},
  {0x03, 0x01, 0x71, 0x09, 0x07},
  {0x36, 0x49, 0x49, 0x49, 0x36},
  {0x26, 0x49, 0x49, 0x49, 0x3E},
  {0x00, 0x36, 0x36, 0x00, 0x00},
  {0x00, 0x56, 0x36, 0x00, 0x00},
  {0x08, 0x14, 0x22, 0x41, 0x00},
  {0x14, 0x14, 0x14, 0x14, 0x14},
  {0x00, 0x41, 0x22, 0x14, 0x08},
  {0x02, 0x01, 0x51, 0x09, 0x06},
  {0x32, 0x49, 0x79, 0x41, 0x3E},
  {0x7C, 0x0A, 0x09, 0x0A, 0x7C},
  {0x7F, 0x49, 0x49, 0x49, 0x36},
  {0x3E, 0x41, 0x41, 0x41, 0x22},
  {0x7F, 0x41, 0x41, 0x41, 0x3E},
  {0x7F, 0x49, 0x49, 0x49, 0x41},
  {0x7F, 0x09, 0x09, 0x09, 0x01},
  {0x3E, 0x41, 0x49, 0x49, 0x7A},
  {0x7F, 0x08, 0x08, 0x08, 0x7F},
  {0x00, 0x41, 0x7F, 0x41, 0x00},
  {0x30, 0x40, 0x40, 0x40, 0x3F},
  {0x7F, 0x08, 0x14, 0x22, 0x41},
  {0x7F, 0x40, 0x40, 0x40, 0x40},
  {0x7F, 0x02, 0x0C, 0x02, 0x7F},
  {0x7F, 0x02, 0x04, 0x08, 0x7F},
  {0x3E, 0x41, 0x41, 0x41, 0x3E},
  {0x7F, 0x09, 0x09, 0x09, 0x06},
  {0x3E, 0x41, 0x51, 0x21, 0x5E},
  {0x7F, 0x09, 0x09, 0x09, 0x76},
  {0x26, 0x49, 0x49, 0x49, 0x32},
  {0x01, 0x01, 0x7F, 0x01, 0x01},
  {0x3F, 0x40, 0x40, 0x40, 0x3F},
  {0x1F, 0x20, 0x40, 0x20, 0x1F},
  {0x3F, 0x40, 0x38, 0x40, 0x3F},
  {0x63, 0x14, 0x08, 0x14, 0x63},
  {0x03, 0x04, 0x78, 0x04, 0x03},
  {0x61, 0x51, 0x49, 0x45, 0x43},
  {0x7F, 0x41, 0x41, 0x00, 0x00},
  {0x02, 0x04, 0x08, 0x10, 0x20},
  {0x00, 0x41, 0x41, 0x7F, 0x00},
  {0x04, 0x02, 0x01, 0x02, 0x04},
  {0x40, 0x40, 0x40, 0x40, 0x40},
  {0x00, 0x01, 0x02, 0x04, 0x00},
  {0x20, 0x54, 0x54, 0x54, 0x78},
  {0x7F, 0x48, 0x44, 0x44, 0x38},
  {0x38, 0x44, 0x44, 0x44, 0x20},
  {0x38, 0x44, 0x44, 0x48, 0x7F},
  {0x38, 0x54, 0x54, 0x54, 0x18},
  {0x08, 0x7E, 0x09, 0x01, 0x02},
  {0x0C, 0x52, 0x52, 0x52, 0x3E},
  {0x7F, 0x08, 0x04, 0x04, 0x78},
  {0x00, 0x44, 0x7D, 0x40, 0x00},
  {0x20, 0x40, 0x44, 0x3D, 0x00},
  {0x7F, 0x10, 0x28, 0x44, 0x00},
  {0x00, 0x41, 0x7F, 0x40, 0x00},
  {0x7C, 0x04, 0x18, 0x04, 0x78},
  {0x7C, 0x08, 0x04, 0x04, 0x78},
  {0x38, 0x44, 0x44, 0x44, 0x38},
  {0x7C, 0x14, 0x14, 0x14, 0x08},
  {0x08, 0x14, 0x14, 0x18, 0x7C},
  {0x7C, 0x08, 0x04, 0x04, 0x08},
  {0x48, 0x54, 0x54, 0x54, 0x20},
  {0x04, 0x3F, 0x44, 0x40, 0x20},
  {0x3C, 0x40, 0x40, 0x20, 0x7C},
  {0x1C, 0x20, 0x40, 0x20, 0x1C},
  {0x3C, 0x40, 0x38, 0x40, 0x3C},
  {0x44, 0x28, 0x10, 0x28, 0x44},
  {0x0C, 0x50, 0x50, 0x50, 0x3C},
  {0x44, 0x64, 0x54, 0x4C, 0x44},
  {0x00, 0x08, 0x36, 0x41, 0x00},
  {0x00, 0x00, 0x7F, 0x00, 0x00},
  {0x00, 0x41, 0x36, 0x08, 0x00},
  {0x08, 0x04, 0x08, 0x10, 0x08}};

const char extra_display_data[95][5] = {
		{0x00, 0x00, 0x00, 0x00, 0x00}, // SPACE
		{0x30, 0x60, 0xC0, 0x60, 0x30}, // Ship facing up top
		{0x18, 0x30, 0x60, 0x30, 0x18}, // Ship facing up 1 down
		{0x0C, 0x18, 0x30, 0x18, 0x0C}, // Ship facing up middle
		{0x06, 0x0C, 0x18, 0x0C, 0x06}, // Ship facing up 3 down
		{0x03, 0x06, 0x0C, 0x06, 0x03}, // ship facing up bottom
		// Ship facing up split
		{0x01, 0x03, 0x06, 0x03, 0x01}, // 1 cut off bottom
		{0x80, 0x00, 0x00, 0x00, 0x80}, // 1 down from top
		{0x00, 0x01, 0x03, 0x01, 0x00}, // 2 cut off bottom
		{0xC0, 0x80, 0x00, 0x80, 0xC0}, // 2 down from top
		{0x00, 0x00, 0x01, 0x00, 0x00}, // 3 cut off bottom
		{0x60, 0xC0, 0x80, 0xC0, 0x60}, // 3 down from top
		//Ship facing down
		{0xC0, 0x60, 0x30, 0x60, 0xC0}, // Ship facing down top
		{0x60, 0x30, 0x18, 0x30, 0x60}, // Ship facing down 1 down
		{0x30, 0x18, 0x0C, 0x18, 0x30}, // Ship facing down middle
		{0x18, 0x0C, 0x06, 0x0C, 0x18}, // Ship facing down 3 down
		{0x0C, 0x06, 0x03, 0x06, 0x0C}, // ship facing down bottom
		//Ship facing down split
		{0x06, 0x03, 0x01, 0x03, 0x06}, // 1 cut off bottom
		{0x00, 0x00, 0x80, 0x00, 0x00}, // 1 down from top
		{0x03, 0x01, 0x00, 0x01, 0x03}, // 2 cut off bottom
		{0x00, 0x80, 0xC0, 0x80, 0x00}, // 2 down from top
		{0x01, 0x00, 0x00, 0x00, 0x01}, // 2 cut off bottom
		{0x80, 0xC0, 0x60, 0xC0, 0x80} // 2 down from top
		};
